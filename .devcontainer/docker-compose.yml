version: "3"

services:
  app:
      build:
        context: ..
        dockerfile: .devcontainer/Dockerfile

      volumes:
        - ../..:/workspaces:cached

      # Overrides default command so things don't shut down after the process ends.
      command: sleep infinity

      # Runs app on the same network as the database container, allows "forwardPorts" in devcontainer.json function.
      # network_mode: service:db
      network_mode: host
    
  db:
    build: ./db
    container_name: production-db
    restart: unless-stopped
    #ports:
    #  - "5432:5432"
    network_mode: host
    env_file:
      - test.env
    volumes:
      - ./postgres_data:/var/lib/postgresql/data
    
volumes:
  postgres_data:
    name: postgres_data
